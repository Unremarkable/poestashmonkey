<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Affix Tester</title>
  <style type="text/css">

dl, ul { margin-top: 0px; margin-bottom: 0px; }

.Compound { background-color: yellow; }
.Ambiguous { color: red; }
.Simple { color: green; }
  </style>
 <!-- <script type="application/javascript" language="javascript" src="GitHub/poestashmonkey/scripts/cache.js">
  </script>

  <script type="application/javascript" language="javascript">
/*
console.log("CharacterList:", Cache.CharacterList);
console.log("CharacterData:", Cache.CharacterData);
console.log("StashMetadata:", Cache.StashMetadata);
console.log("StashData:",     Cache.StashData);

Cache.OnReceiveCharacterList.Add(function (data) {
	console.log("OnReceiveCharacterList", data, Cache.CharacterList);
});

Cache.GetCharacterList();




var	NONE    = 0x00,
	ANY     = 0xFF,
	STR     = 0x01,
	DEX     = 0x02,
	INT     = 0x04,
	STR_DEX = 0x08,
	STR_INT = 0x10,
	DEX_INT = 0x20;

var blarg = DEX | DEX_INT;

*/

  </script>
-->

  <script type="application/javascript" language="javascript" src="http://code.jquery.com/jquery-1.11.1.min.js">
  </script>

  <script type="application/javascript" language="javascript" src="scripts/data/affixes.js">
//	var Affix;
  </script>

  <script type="application/javascript" language="javascript" src="scripts/data/baseEquipment.js">
//	var baseEquipment;
  </script>

<script type="application/javascript" language="javascript">
	var Items = [{"verified":false,"w":2,"h":2,"icon":"http://webcdn.pathofexile.com/image/Art/2DItems/Armours/Boots/BootsStrDex3.png?scale=1&w=2&h=2&v=601dc135a14c1121dca118c2640a13353","support":true,"league":"Ambush","sockets":[{"group":0,"attr":"S"}],"name":"Golem Slippers","typeLine":"Wyrmscale Boots","identified":true,"corrupted":false,"properties":{"Armour":{"name":"Armour","values":[["136",1]],"displayMode":0},"Evasion Rating":{"name":"Evasion Rating","values":[["80",0]],"displayMode":0}},"requirements":[{"name":"Level","values":[["51",0]],"displayMode":0},{"name":"Str","values":[["48",0]],"displayMode":1},{"name":"Dex","values":[["48",0]],"displayMode":1}],"explicitMods":{"+# to Armour":{"description":"+56 to Armour","name":"+# to Armour","values":["56"]},"+# to maximum Life":{"description":"+78 to maximum Life","name":"+# to maximum Life","values":["78"]},"#% increased Rarity of Items found":{"description":"8% increased Rarity of Items found","name":"#% increased Rarity of Items found","values":["8"]},"+#% to Lightning Resistance":{"description":"+17% to Lightning Resistance","name":"+#% to Lightning Resistance","values":["17"]},"#% increased Movement Speed":{"description":"30% increased Movement Speed","name":"#% increased Movement Speed","values":["30"]}},"frameType":2,"x":0,"y":3,"inventoryId":"Stash14","socketedItems":[],"prepared":true,"implicitMods":{}},{"verified":false,"w":1,"h":3,"icon":"http://webcdn.pathofexile.com/image/Art/2DItems/Weapons/OneHandWeapons/Wands/Wand6.png?scale=1&w=1&h=3&v=eff821a47b093afcfff2c21aa8f447d53","support":true,"league":"Ambush","sockets":[{"group":0,"attr":"I"}],"name":"Phoenix Gnarl","typeLine":"Omen Wand","identified":true,"corrupted":false,"properties":{"Wand":{"name":"Wand","values":[],"displayMode":0},"Quality":{"name":"Quality","values":[["+15%",1]],"displayMode":0},"Physical Damage":{"name":"Physical Damage","values":[["63-116",1]],"displayMode":0},"Critical Strike Chance":{"name":"Critical Strike Chance","values":[["11%",1]],"displayMode":0},"Attacks per Second":{"name":"Attacks per Second","values":[["1.10",0]],"displayMode":0}},"requirements":[{"name":"Level","values":[["53",0]],"displayMode":0},{"name":"Int","values":[["200",0]],"displayMode":1}],"implicitMods":{"#% increased Spell Damage":{"description":"14% increased Spell Damage","name":"#% increased Spell Damage","values":["14"]}},"explicitMods":{"+# to Level of Fire Gems in this item":{"description":"+1 to Level of Fire Gems in this item","name":"+# to Level of Fire Gems in this item","values":["1"]},"#% increased Physical Damage":{"description":"39% increased Physical Damage","name":"#% increased Physical Damage","values":["39"]},"Adds #-# Physical Damage":{"description":"Adds 16-28 Physical Damage","name":"Adds #-# Physical Damage","values":["16","28"]},"#% increased Cast Speed":{"description":"10% increased Cast Speed","name":"#% increased Cast Speed","values":["10"]},"#% increased Critical Strike Chance":{"description":"28% increased Critical Strike Chance","name":"#% increased Critical Strike Chance","values":["28"]},"+# to Accuracy Rating":{"description":"+50 to Accuracy Rating","name":"+# to Accuracy Rating","values":["50"]}},"frameType":2,"x":2,"y":7,"inventoryId":"Stash14","socketedItems":[],"prepared":true,"weaponInfo":{"name":"Phoenix Gnarl","baseItem":"Omen Wand","baseWeaponDps":"39.6","physical":{"min":63,"max":116,"avg":89.5,"label":"63-116"},"elemental":{"min":0,"max":0,"avg":0},"attacksPerSecond":1.1,"cps":12.100000000000001,"pdps":98.45,"edps":0,"dps":98.45,"pIncreaseDps":148.61111111111111}},{"verified":false,"w":2,"h":3,"icon":"http://webcdn.pathofexile.com/image/Art/2DItems/Armours/BodyArmours/BodyStr3C.png?scale=1&w=2&h=3&v=6bbdcc26e9e31b2cf79a6f0fecdf573f3","support":true,"league":"Ambush","sockets":[{"group":0,"attr":"S"},{"group":1,"attr":"S"},{"group":1,"attr":"S"},{"group":1,"attr":"I"}],"name":"Tempest Pelt","typeLine":"Majestic Plate","identified":true,"corrupted":false,"properties":{"Armour":{"name":"Armour","values":[["775",1]],"displayMode":0}},"requirements":[{"name":"Level","values":[["53",0]],"displayMode":0},{"name":"Str","values":[["144",0]],"displayMode":1}],"explicitMods":{"+# to Strength":{"description":"+26 to Strength","name":"+# to Strength","values":["26"]},"#% increased Armour":{"description":"105% increased Armour","name":"#% increased Armour","values":["105"]},"+# to maximum Life":{"description":"+44 to maximum Life","name":"+# to maximum Life","values":["44"]},"+#% to Cold Resistance":{"description":"+25% to Cold Resistance","name":"+#% to Cold Resistance","values":["25"]},"+#% to Lightning Resistance":{"description":"+23% to Lightning Resistance","name":"+#% to Lightning Resistance","values":["23"]},"#% increased Block and Stun Recovery":{"description":"12% increased Block and Stun Recovery","name":"#% increased Block and Stun Recovery","values":["12"]}},"frameType":2,"x":0,"y":0,"inventoryId":"Stash14","socketedItems":[],"prepared":true,"implicitMods":{}},{"verified":false,"w":2,"h":2,"icon":"http://webcdn.pathofexile.com/image/Art/2DItems/Weapons/OneHandWeapons/Claws/Claw8.png?scale=1&w=2&h=2&v=46bd8600203c3bdfb57e6d065d47b8013","support":true,"league":"Ambush","sockets":[{"group":0,"attr":"D"},{"group":0,"attr":"I"},{"group":0,"attr":"I"}],"name":"Fate Skewer","typeLine":"Eagle Claw","identified":true,"corrupted":false,"properties":{"Claw":{"name":"Claw","values":[],"displayMode":0},"Quality":{"name":"Quality","values":[["+12%",1]],"displayMode":0},"Physical Damage":{"name":"Physical Damage","values":[["40-159",1]],"displayMode":0},"Critical Strike Chance":{"name":"Critical Strike Chance","values":[["6.5%",0]],"displayMode":0},"Attacks per Second":{"name":"Attacks per Second","values":[["1.35",0]],"displayMode":0}},"requirements":[{"name":"Level","values":[["55",0]],"displayMode":0},{"name":"Dex","values":[["94",0]],"displayMode":1},{"name":"Int","values":[["94",0]],"displayMode":1}],"implicitMods":{"#% of Physical Attack Damage Leeched as Life":{"description":"6% of Physical Attack Damage Leeched as Life","name":"#% of Physical Attack Damage Leeched as Life","values":["6"]}},"explicitMods":{"#% increased Physical Damage":{"description":"140% increased Physical Damage","name":"#% increased Physical Damage","values":["140"]},"#% increased Global Critical Strike Multiplier":{"description":"27% increased Global Critical Strike Multiplier","name":"#% increased Global Critical Strike Multiplier","values":["27"]},"+#% to Fire Resistance":{"description":"+26% to Fire Resistance","name":"+#% to Fire Resistance","values":["26"]},"#% increased Stun Duration on enemies":{"description":"27% increased Stun Duration on enemies","name":"#% increased Stun Duration on enemies","values":["27"]},"+# to Accuracy Rating":{"description":"+69 to Accuracy Rating","name":"+# to Accuracy Rating","values":["69"]}},"frameType":2,"x":0,"y":8,"inventoryId":"Stash14","socketedItems":[],"prepared":true,"weaponInfo":{"name":"Fate Skewer","baseItem":"Eagle Claw","baseWeaponDps":"53.3","physical":{"min":40,"max":159,"avg":99.5,"label":"40-159"},"elemental":{"min":0,"max":0,"avg":0},"attacksPerSecond":1.35,"cps":8.775,"pdps":134.32500000000002,"edps":0,"dps":134.32500000000002,"pIncreaseDps":152.01688555347096}},{"verified":false,"w":2,"h":4,"icon":"http://webcdn.pathofexile.com/image/Art/2DItems/Weapons/TwoHandWeapons/TwoH…ords/TwoHandSword6.png?scale=1&w=2&h=4&v=2c46a69178977d49c64e93c354b1200c3","support":true,"league":"Ambush","sockets":[{"group":0,"attr":"S"}],"name":"Havoc Stinger","typeLine":"Tiger Sword","identified":true,"corrupted":false,"properties":{"Two Handed Sword":{"name":"Two Handed Sword","values":[],"displayMode":0},"Physical Damage":{"name":"Physical Damage","values":[["124-205",1]],"displayMode":0},"Elemental Damage":{"name":"Elemental Damage","values":[["33-75",4]],"displayMode":0},"Critical Strike Chance":{"name":"Critical Strike Chance","values":[["5%",0]],"displayMode":0},"Attacks per Second":{"name":"Attacks per Second","values":[["1.30",0]],"displayMode":0}},"requirements":[{"name":"Level","values":[["51",0]],"displayMode":0},{"name":"Str","values":[["80",0]],"displayMode":1},{"name":"Dex","values":[["96",0]],"displayMode":1}],"implicitMods":{"#% increased Accuracy Rating":{"description":"18% increased Accuracy Rating","name":"#% increased Accuracy Rating","values":["18"]}},"explicitMods":{"#% increased Physical Damage":{"description":"125% increased Physical Damage","name":"#% increased Physical Damage","values":["125"]},"+# to Dexterity":{"description":"+22 to Dexterity","name":"+# to Dexterity","values":["22"]},"Adds #-# Fire Damage":{"description":"Adds 33-75 Fire Damage","name":"Adds #-# Fire Damage","values":["33","75"]},"+# Life gained for each enemy hit by your Attacks":{"description":"+3 Life gained for each enemy hit by your Attacks","name":"+# Life gained for each enemy hit by your Attacks","values":["3"]}},"frameType":2,"x":2,"y":0,"inventoryId":"Stash14","socketedItems":[],"prepared":true,"weaponInfo":{"name":"Havoc Stinger","baseItem":"Tiger Sword","baseWeaponDps":"94.9","physical":{"min":124,"max":205,"avg":164.5,"label":"124-205"},"elemental":{"min":33,"max":75,"avg":54},"fire":{"min":33,"max":75,"avg":54,"label":"33-75"},"attacksPerSecond":1.3,"cps":6.5,"pdps":213.85,"edps":70.2,"dps":284.05,"pIncreaseDps":199.31506849315065}},{"verified":false,"w":2,"h":2,"icon":"http://webcdn.pathofexile.com/image/Art/2DItems/Armours/Shields/ShieldInt3.png?scale=1&w=2&h=2&v=0b4ca72b3f1678f750402c910c3fb09c3","support":true,"league":"Ambush","sockets":[{"group":0,"attr":"I"}],"name":"Carrion Duty","typeLine":"Ivory Spirit Shield","identified":true,"corrupted":false,"properties":{"Chance to Block":{"name":"Chance to Block","values":[["24%",0]],"displayMode":0},"Energy Shield":{"name":"Energy Shield","values":[["81",1]],"displayMode":0}},"requirements":[{"name":"Level","values":[["41",0]],"displayMode":0},{"name":"Int","values":[["100",0]],"displayMode":1}],"implicitMods":{"#% increased Spell Damage":{"description":"15% increased Spell Damage","name":"#% increased Spell Damage","values":["15"]}},"explicitMods":{"#% increased Critical Strike Chance for Spells":{"description":"65% increased Critical Strike Chance for Spells","name":"#% increased Critical Strike Chance for Spells","values":["65"]},"+# to maximum Mana":{"description":"+24 to maximum Mana","name":"+# to maximum Mana","values":["24"]},"#% increased Energy Shield":{"description":"40% increased Energy Shield","name":"#% increased Energy Shield","values":["40"]},"+# to maximum Energy Shield":{"description":"+15 to maximum Energy Shield","name":"+# to maximum Energy Shield","values":["15"]},"#% increased Block and Stun Recovery":{"description":"26% increased Block and Stun Recovery","name":"#% increased Block and Stun Recovery","values":["26"]}},"frameType":2,"x":0,"y":10,"inventoryId":"Stash14","socketedItems":[],"prepared":true},{"verified":false,"w":2,"h":3,"icon":"http://webcdn.pathofexile.com/image/Art/2DItems/Weapons/OneHandWeapons/OneHandAxes/OneHandAxe2.png?scale=1&w=2&h=3&v=e856f7a39b267f11a7a1a01b11412f613","support":true,"league":"Ambush","sockets":[{"group":0,"attr":"S"}],"name":"Victory Spawn","typeLine":"Jasper Axe","identified":true,"corrupted":false,"properties":{"One Handed Axe":{"name":"One Handed Axe","values":[],"displayMode":0},"Physical Damage":{"name":"Physical Damage","values":[["60-94",1]],"displayMode":0},"Elemental Damage":{"name":"Elemental Damage","values":[["1-10",6]],"displayMode":0},"Critical Strike Chance":{"name":"Critical Strike Chance","values":[["6.45%",1]],"displayMode":0},"Attacks per Second":{"name":"Attacks per Second","values":[["1.25",0]],"displayMode":0}},"requirements":[{"name":"Level","values":[["36",0]],"displayMode":0},{"name":"Str","values":[["86",0]],"displayMode":1},{"name":"Dex","values":[["40",0]],"displayMode":1}],"explicitMods":{"#% increased Physical Damage":{"description":"108% increased Physical Damage","name":"#% increased Physical Damage","values":["108"]},"Adds #-# Lightning Damage":{"description":"Adds 1-10 Lightning Damage","name":"Adds #-# Lightning Damage","values":["1","10"]},"#% increased Critical Strike Chance":{"description":"29% increased Critical Strike Chance","name":"#% increased Critical Strike Chance","values":["29"]},"#% increased Global Critical Strike Multiplier":{"description":"15% increased Global Critical Strike Multiplier","name":"#% increased Global Critical Strike Multiplier","values":["15"]}},"frameType":2,"x":2,"y":4,"inventoryId":"Stash14","socketedItems":[],"prepared":true,"implicitMods":{},"weaponInfo":{"name":"Victory Spawn","baseItem":"Jasper Axe","baseWeaponDps":"46.3","physical":{"min":60,"max":94,"avg":77,"label":"60-94"},"elemental":{"min":1,"max":10,"avg":5.5},"lightning":{"min":1,"max":10,"avg":5.5,"label":"1-10"},"attacksPerSecond":1.25,"cps":8.0625,"pdps":96.25,"edps":6.875,"dps":103.125,"pIncreaseDps":122.73218142548599}},{"verified":false,"w":2,"h":3,"icon":"http://webcdn.pathofexile.com/image/Art/2DItems/Weapons/OneHandWeapons/OneH…ords/OneHandSword6.png?scale=1&w=2&h=3&v=7351ad920971b29206a9dfddb1680baf3","support":true,"league":"Ambush","sockets":[{"group":0,"attr":"S"}],"name":"Loath Spiker","typeLine":"Elder Sword","identified":true,"corrupted":false,"properties":{"One Handed Sword":{"name":"One Handed Sword","values":[],"displayMode":0},"Physical Damage":{"name":"Physical Damage","values":[["50-94",1]],"displayMode":0},"Elemental Damage":{"name":"Elemental Damage","values":[["24-44",5]],"displayMode":0},"Critical Strike Chance":{"name":"Critical Strike Chance","values":[["6.1%",1]],"displayMode":0},"Attacks per Second":{"name":"Attacks per Second","values":[["1.38",1]],"displayMode":0}},"requirements":[{"name":"Level","values":[["47",0]],"displayMode":0},{"name":"Str","values":[["81",0]],"displayMode":1},{"name":"Dex","values":[["81",0]],"displayMode":1}],"implicitMods":{"#% increased Accuracy Rating":{"description":"18% increased Accuracy Rating","name":"#% increased Accuracy Rating","values":["18"]}},"explicitMods":{"#% increased Physical Damage":{"description":"80% increased Physical Damage","name":"#% increased Physical Damage","values":["80"]},"Adds #-# Cold Damage":{"description":"Adds 24-44 Cold Damage","name":"Adds #-# Cold Damage","values":["24","44"]},"#% increased Attack Speed":{"description":"6% increased Attack Speed","name":"#% increased Attack Speed","values":["6"]},"#% increased Critical Strike Chance":{"description":"22% increased Critical Strike Chance","name":"#% increased Critical Strike Chance","values":["22"]}},"frameType":2,"x":0,"y":5,"inventoryId":"Stash14","socketedItems":[],"prepared":true,"weaponInfo":{"name":"Loath Spiker","baseItem":"Elder Sword","baseWeaponDps":"52.0","physical":{"min":50,"max":94,"avg":72,"label":"50-94"},"elemental":{"min":24,"max":44,"avg":34},"cold":{"min":24,"max":44,"avg":34,"label":"24-44"},"attacksPerSecond":1.38,"cps":8.418,"pdps":99.35999999999999,"edps":46.919999999999995,"dps":146.27999999999997,"pIncreaseDps":181.30769230769226}}]
	
	console.log(Items);
/*
	function _isValid(item, solution) {
		if (solution.Prefixes > 3 || solution.Suffixes > 3)
			return false;
		for (var m in item.explicitMods) {
			var mod = item.explicitMods[m];
			var val = mod.values;
			var sln = solution.mods[mod.name];
			if (val[0] < sln[0].min || val[0] > sln[0].max)
				return false;
			if (val.length == 2)
				if (val[1] < sln[1].min || val[1] > sln[1].max)
					return false;
		}
	}

	function _getProperty(s, n) {
		var sum = [0, 0];

		for (var )
	}
	
	function _solve(item, mods) {
		var solution = {};

		for (var m in mods) {

		}

		//	if (mod.Affixes.length == 1) {
		//		solution[mod.Affixes[0].affix].push(mod.Affixes[0]);
		//		delete mods[a];
		//	}


		console.log(solution);
		console.log(mods);
	}*/

	function getAffixesFor(item, baseItem) {
		var mods = {};

		for (var m in item.explicitMods) {
			var mod = item.explicitMods[m];
			
			if (!mods[mod.name])
				mods[mod.name] = {
					"Prefix"   : false,
					"Suffix"   : false, 
					"Compound" : false,
					"Affixes"  : {}
				};

			for (var gid in Affixes[mod.name]) {
				var group = Affixes[mod.name][gid];

				if (group.properties.length == 2) {
					if (!mods[group.properties[1]]) {
						mods[group.properties[1]] = {
							"Prefix"   : false,
							"Suffix"   : false, 
							"Compound" : false,
							"Affixes"  : {}
						};
					}
				}

				for (var a in group.affixes) {
					var affix = group.affixes[a];

					if (affix.typemask[baseItem.type] != 0xff && !(affix.typemask[baseItem.type] & baseItem.subtype))
						continue;

					if (affix.properties[0].range[0].min > mod.values[0])
						continue;
						
					if (affix.properties.length == 2) {
						var mod2 = item.explicitMods[affix.properties[1].name];
						if (!mod2)
							continue;
						if (affix.properties[1].range[0].min > mod2.values[0])
							continue;

						mods[mod.name].Compound = true;
						mods[mod2.name].Compound = true;
					} else if (affix.properties[0].range.length == 2) {
						if (affix.properties[0].range[1].min > mod.values[1])
							continue;
					}
					
					mods[mod.name][affix.affix] = true;

					if (!mods[mod.name].Affixes[gid])
						mods[mod.name].Affixes[gid] = [];
					mods[mod.name].Affixes[gid].push(affix);
				}
			}
		}
			
		for (var a in mods) {
			var mod = mods[a];
			if (!mod.Compound && (!mod.Prefix || !mod.Suffix)) {
			//	simple mod.
				for (var gid in mod.Affixes) {
					var group = mod.Affixes[gid];

					var next = [];
					for (var aff in group) {
						var affix = group[aff];
						if (affix.properties[0].range[0].max < item.explicitMods[a].values[0])
							continue;
						if (affix.properties.length == 2) {
							if (affix.properties[1].range[0].max < item.explicitMods[affix.properties[1].name].values[0])
								continue;
						} else if (affix.properties[0].range.length == 2) {
							if (affix.properties[0].range[1].max < item.explicitMods[a].values[1])
								continue;
						}
						
						next.push(affix);
					}
					mod.Affixes[gid] = next;
				}
			}
		}

        return mods;
	}

    // Any prefix or suffix that is the only possibility for a given type will get counted.
    // Ideally these are the ones we have guessed for sure.
    // There should be a max of 3 prefixes and 3 suffixes.
    // If there are more than 3 of either then one of them is wrong (i.e. incorrect guess caused by a compound stat that needs to be eliminated).
    function addKnownPrefixAndSuffixCountToItem(item, mods) {
        var prefixCount = 0;
        var suffixCount = 0;

        for (var a in mods) {
            var mod = mods[a];
            if (Object.keys(mod.Affixes).length == 1) {
                for(var key in mod.Affixes) break; // get the first and only element
                if (mod.Affixes[key].length == 1) {
                    if (mod.Affixes[key][0].affix == "Prefix") prefixCount++;
                    if (mod.Affixes[key][0].affix == "Suffix") suffixCount++;
                }
            }
        }
        item.prefixCount = prefixCount;
        item.suffixCount = suffixCount;

        //console.log("Prefix count: " + item.prefixCount);
        //console.log("Suffix count: " + item.suffixCount);
    }
 
function getBaseItem(item) {
    var name = item.typeLine;
 
    if (baseEquipment[name]) return baseEquipment[name];
 
    // search for and remove suffix
    var end = name.indexOf(" of ");
    if (end != -1) name = name.substring(0, end);
 
    if (baseEquipment[name]) return baseEquipment[name];
 
    // iteratively remove prefixes
    var start = 0;
    while ((start = name.indexOf(" ", start)) != -1) {
        name = name.substring(start + 1);
 
        if (baseEquipment[name]) return baseEquipment[name];
    }
 
    return false;
}

//	console.log("Item", Items[0]);
//	console.log("BaseItem", getBaseItem(Items[0]));
//	console.log("Affixes", getAffixesFor(Items[0], getBaseItem(Items[0])));

	var ATTR = {
		0x00 : "NONE",
		0xFF : "ANY",
		0x01 : "STR",
		0x02 : "DEX",
		0x04 : "INT",
		0x08 : "STR_DEX",
		0x10 : "STR_INT",
		0x20 : "DEX_INT"
	};

	$(document.body).ready(function() {
		$(document.body).append($("<dl></dl>").append($.map(Items, function(item) {
			var base = getBaseItem(item);
			var affixes = getAffixesFor(item, base);
            addKnownPrefixAndSuffixCountToItem(item, affixes);

			function li_property(property) {
				if (property.range.length == 2)
					return $("<li class='property'>"+property.name.replace("#-#","["+property.range[0].min+"-"+property.range[0].max+"]-["+property.range[1].min+"-"+property.range[1].max+"]")+"</li>");
				return $("<li class='property'>"+property.name.replace("#","["+property.range[0].min+"-"+property.range[0].max+"]")+"</li>");
			}

			function draw_affix(affix) {
				return [
					$("<dt class='affix'>" + affix.name + " (" + affix.level + ")</dt>"),
					$("<dd class='affix'></dd>").append(
						$("<ul class='affix'></ul>").append($.map(affix.properties, li_property))
					)
				];
			}

			function draw_group(group) {
				return $("<li class='group'></li>").append(
					$("<dl class='group'></dl>").append($.map(group, draw_affix))
				);
			}

			function draw_mods(mod) {
				var mods = [
					$("<dt class='mods'>" + mod.description + "</dt>"),
					$("<dd class='mods'></dd>").append(
						$("<ul class='mods'></ul>").append($.map(affixes[mod.name].Affixes, draw_group))
					)
				];

				if (affixes[mod.name].Compound || (affixes[mod.name].Prefix && affixes[mod.name].Suffix))
					mods[1].addClass("Compound");

				return mods;
			}

			function draw_item(item) {
				return [
					$("<dt>" + item.name + " (" + item.typeLine + " " + ATTR[base.subtype] + ")</dt>"),
					$("<dd></dd>").append(
						$("<dl></dl>").append($.map(item.explicitMods, draw_mods))
					)
				];
			}

			return draw_item(item);
		})));
	});

  </script>
</head>
<body>

</body>
</html>